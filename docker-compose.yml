services:
  gateway:
    build:
      context: .
      dockerfile: packages/gateway/Dockerfile
    ports:
      - '3100:3100'
    environment:
      PORT: '3100'
      LOG_LEVEL: info
      REDIS_URL: redis://redis:6379
      MONGODB_URL: mongodb://mongodb:27017
      MONGODB_DATABASE: ai_gateway
      API_KEYS: ${API_KEYS:-}
      AWS_REGION: ${AWS_REGION:-ap-southeast-2}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    depends_on:
      - redis
      - mongodb
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    ports:
      - '6379:6379'
    volumes:
      - redis-data:/data
    restart: unless-stopped

  mongodb:
    image: mongo:7
    ports:
      - '27017:27017'
    volumes:
      - mongo-data:/data/db
    restart: unless-stopped

volumes:
  redis-data:
  mongo-data:
